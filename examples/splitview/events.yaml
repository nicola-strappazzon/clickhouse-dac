---
database:
  name: splitview
  delete: true
table:
  name: events
  delete: true
  columns:
    - { name: event_date, type: Date }
    - { name: ts,         type: DateTime }
    - { name: user_id,    type: UInt64 }
    - { name: session_id, type: UInt64 }
    - { name: country,    type: "LowCardinality(String)" }
    - { name: device,     type: "LowCardinality(String)" }
    - { name: os_version, type: "LowCardinality(String)" }
    - { name: event_name, type: "LowCardinality(String)" }
    - { name: amount,     type: Float64 }
    - { name: extra_tag,  type: "LowCardinality(String)" }
  engine: MergeTree
  partition_by: ["toYYYYMM(event_date)"]
  order_by: [event_date, user_id, ts]
  query: |
    INSERT INTO events
    SELECT
        toDate('2025-08-01') + (rand() % 10) AS event_date,
        toDateTime(event_date) + (rand() % 86400) AS ts,
        cityHash64(number) % 100000 + 1 AS user_id,
        cityHash64(number * 13) AS session_id,
        arrayElement(['ES','US','BR','DE','FR','MX','AR','CL','CO','IT'], 1 + (rand() % 10)) AS country,
        arrayElement(['mobile','desktop','tablet'], 1 + (rand() % 3)) AS device,
        arrayElement(['iOS14','iOS15','Android12','Android13','Win11','macOS14'], 1 + (rand() % 6)) AS os_version,
        arrayElement(['view','scroll','click','add_to_cart','purchase'], 1 + (rand() % 5)) AS event_name,
        if(event_name = 'purchase', round(randUniform(1, 15000) / 100.0, 2), 0.0) AS amount,
        arrayElement(['utm:seo','utm:email','utm:ads','utm:direct'], 1 + (rand() % 4)) AS extra_tag
    FROM numbers(10_000)
